<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload de Imagem para Produto</title>
</head>
<body>
    <h1>Upload de Imagem para Produto</h1>
    
    <form id="uploadForm">
        <div>
            <label for="token">Token JWT (obtenha fazendo login):</label><br>
            <input type="text" id="token" name="token" placeholder="Cole o token aqui" size="100" required>
        </div>
        <br>
        
        <div>
            <label for="produto_id">ID do Produto:</label><br>
            <input type="number" id="produto_id" name="produto_id" required>
        </div>
        <br>
        
        <div>
            <label for="imagem">Selecione a imagem:</label><br>
            <input type="file" id="imagem" name="imagem" accept="image/jpeg,image/png,image/gif,image/webp" required>
        </div>
        <br>
        
        <button type="submit">Enviar Imagem</button>
    </form>
    
    <div id="resultado" style="margin-top: 20px;"></div>
    
    <hr>
    <h2>Fazer Login para obter Token:</h2>
    <form id="loginForm">
        <div>
            <label for="email">Email:</label><br>
            <input type="email" id="email" name="email" value="admin@produtos.com">
        </div>
        <br>
        <div>
            <label for="senha">Senha:</label><br>
            <input type="password" id="senha" name="senha" value="123456">
        </div>
        <br>
        <button type="submit">Fazer Login</button>
    </form>
    
    <div id="loginResultado" style="margin-top: 20px;"></div>
    
    <script>
        // Funcao para fazer login e obter token
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            const loginResultadoDiv = document.getElementById('loginResultado');
            const tokenInput = document.getElementById('token');
            
            loginResultadoDiv.innerHTML = '<p>Fazendo login...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, senha })
                });
                
                const data = await response.json();
                
                if (data.sucesso) {
                    tokenInput.value = data.dados.token;
                    loginResultadoDiv.innerHTML = `
                        <p style="color: green;"><strong>Login realizado com sucesso!</strong></p>
                        <p>Token copiado para o campo de token acima.</p>
                        <p><strong>Usuario:</strong> ${data.dados.usuario.nome} (${data.dados.usuario.email})</p>
                    `;
                } else {
                    loginResultadoDiv.innerHTML = `
                        <p style="color: red;"><strong>Erro no login:</strong></p>
                        <p>${data.erro}: ${data.mensagem}</p>
                    `;
                }
            } catch (error) {
                loginResultadoDiv.innerHTML = `<p style="color: red;">Erro ao fazer login: ${error.message}</p>`;
            }
        });
        
        // Funcao para upload de imagem
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const token = document.getElementById('token').value;
            const produtoId = document.getElementById('produto_id').value;
            const fileInput = document.getElementById('imagem');
            const resultadoDiv = document.getElementById('resultado');
            
            if (!fileInput.files[0]) {
                resultadoDiv.innerHTML = '<p style="color: red;">Por favor, selecione uma imagem.</p>';
                return;
            }
            
            const formData = new FormData();
            formData.append('imagem', fileInput.files[0]);
            formData.append('produto_id', produtoId);
            
            resultadoDiv.innerHTML = '<p>Enviando imagem...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/api/produtos/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.sucesso) {
                    resultadoDiv.innerHTML = `
                        <h3>Sucesso!</h3>
                        <p><strong>Mensagem:</strong> ${data.mensagem}</p>
                        <p><strong>Nome do arquivo:</strong> ${data.dados.nomeArquivo}</p>
                        <p><strong>Caminho:</strong> ${data.dados.caminho}</p>
                        <p><strong>Imagem enviada:</strong> <a href="http://localhost:3000${data.dados.caminho}" target="_blank">Ver imagem</a></p>
                    `;
                } else {
                    resultadoDiv.innerHTML = `
                        <h3>Erro!</h3>
                        <p><strong>Erro:</strong> ${data.erro}</p>
                        <p><strong>Mensagem:</strong> ${data.mensagem}</p>
                    `;
                }
            } catch (error) {
                resultadoDiv.innerHTML = `<p style="color: red;">Erro ao enviar: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>

